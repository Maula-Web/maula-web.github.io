<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEÑA MAULAS - Resultados y Clasificación</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .results-wrapper {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 70vh;
            max-width: 100%;
            border: 1px solid #eee;
            border-radius: 8px;
            background: var(--resultados-cell-bg);
            position: relative;
            margin: 0 auto;
        }

        .results-table {
            border-collapse: separate;
            /* Allows sticky headers */
            border-spacing: 0;
            width: max-content;
            /* Expand as needed */
            min-width: 100%;
        }

        .results-table th,
        .results-table td {
            padding: 0.5rem 0.7rem;
            /* Slightly larger for better readability */
            text-align: center;
            border-bottom: 1px solid #eee;
            border-right: 1px solid #eee;
            white-space: nowrap;
            background-color: var(--resultados-cell-bg);
            /* Prevent wrapping unless necessary */
        }

        .results-table tbody tr:nth-child(even) td {
            background-color: var(--resultados-cell-alt-bg);
        }

        /* Desktop only: Maximize table width */
        @media (min-width: 1025px) {

            /* Horizontal menu (default) */
            .results-wrapper {
                width: calc(100vw - 140px);
                max-width: calc(100vw - 140px);
            }

            .resultados-page .main-container {
                padding: 1rem 0.5rem !important;
                max-width: 100vw;
                overflow: visible;
            }

            /* Vertical menu - account for 250px sidebar */
            body.layout-vertical .results-wrapper {
                width: calc(100vw - 300px);
                /* 250px sidebar + 50px margin */
                max-width: calc(100vw - 300px);
            }
        }

        /* Sticky Header (Socio Names) */
        .results-table thead th {
            position: sticky;
            top: 0;
            background-color: var(--resultados-header-bg);
            color: var(--resultados-header-text);
            z-index: 10;
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            font-size: 0.85rem;
            height: 70px;
            /* Base height for header */
        }

        /* Summary Sticky Rows */
        .row-total,
        .row-hits,
        .row-bonus,
        .row-prizes {
            position: sticky;
            z-index: 9;
        }

        .row-total {
            top: 70px;
        }

        .row-hits {
            top: 125px;
        }

        .row-bonus {
            top: 160px;
        }

        .row-prizes {
            top: 195px;
            border-bottom: 3px solid var(--primary-purple);
        }

        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 11 !important;
            border-right: 2px solid #ddd;
        }

        .label-total,
        .label-hits,
        .label-bonus {
            background-color: var(--resultados-summary-label-bg);
            color: var(--resultados-summary-label-text);
        }

        .label-prizes {
            background: var(--resultados-prize-label-bg);
            color: var(--resultados-summary-label-text);
        }

        /* Sticky First Column (Jornadas) */
        .results-table td:first-child,
        .results-table th:first-child {
            position: sticky;
            left: 0;
            background-color: var(--resultados-sticky-col-bg);
            z-index: 1;
            font-weight: bold;
            border-right: 2px solid #ddd;
            color: var(--resultados-sticky-col-text);
            min-width: 140px;
            width: 160px;
            height: 3em;
            vertical-align: middle;
            white-space: normal;
            line-height: 1.2;
        }

        /* Fix for top-left corner overlap */
        .results-table thead th:first-child {
            z-index: 20;
            background-color: var(--resultados-corner-bg);
        }

        /* Highlight Total Row */
        .total-row td {
            background-color: var(--resultados-summary-row-bg);
            font-weight: bold;
            border-top: 2px solid var(--primary-purple);
            color: var(--resultados-summary-row-text);
            font-size: 0.85rem;
        }

        .total-row td:first-child {
            background-color: var(--resultados-summary-total-bg);
            color: var(--resultados-summary-total-text);
        }

        .hits-cell {
            font-size: 0.9rem;
        }

        .hits-perfect {
            color: #1976d2;
            font-weight: bold;
            background-color: #e3f2fd;
        }

        .accumulated-score {
            font-size: 1.3rem;
            color: var(--resultados-total-points-text);
            font-weight: bold;
        }

        /* Estilos para filas de resumen */
        .summary-row {
            background-color: var(--resultados-summary-row-bg);
            font-size: 0.9rem;
        }

        .summary-row td {
            background-color: var(--resultados-summary-row-bg);
            color: var(--resultados-summary-row-text);
        }

        .summary-row td:first-child {
            background-color: var(--resultados-summary-label-bg);
            color: var(--resultados-summary-label-text);
        }

        /* Resaltado de máximo acertante en azul */
        .max-hits-cell {
            background-color: var(--resultados-winner-bg) !important;
            color: var(--resultados-winner-text) !important;
        }

        .min-hits-cell {
            background-color: var(--resultados-loser-bg) !important;
            color: var(--resultados-loser-text) !important;
        }

        /* Mobile Adjustments for Resultados */
        @media (max-width: 850px) {
            .results-table thead th {
                height: 90px;
                /* Taller on mobile for wrapped names */
                font-size: 0.75rem !important;
            }

            .row-total {
                top: 90px;
            }

            .row-hits {
                top: 135px;
            }

            .row-bonus {
                top: 165px;
            }

            .row-prizes {
                top: 195px;
            }

            .results-table th:first-child,
            .results-table td:first-child {
                min-width: 100px !important;
                width: 100px !important;
                font-size: 0.75rem !important;
            }

            .results-table th,
            .results-table td {
                padding: 0.3rem 0.4rem !important;
                font-size: 0.8rem !important;
            }

            .accumulated-score {
                font-size: 1.1rem !important;
            }
        }

        /* Landscape Mobile / Low Height screens */
        @media (max-height: 500px) and (max-width: 950px) {
            .results-wrapper {
                max-height: 60vh !important;
            }

            .results-table thead th {
                height: 50px;
                padding: 4px !important;
                font-size: 0.75rem !important;
            }

            .row-total {
                top: 50px;
            }

            .row-hits {
                top: 85px;
            }

            .row-bonus {
                top: 110px;
            }

            .row-prizes {
                top: 135px;
            }

            .summary-row td {
                padding: 2px 4px !important;
                font-size: 0.7rem !important;
            }

            .accumulated-score {
                font-size: 0.9rem !important;
            }
        }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- DB Config -->
    <script src="js/firebase-init.js"></script>
    <script src="js/db-service.js"></script>
</head>

<body class="page-body resultados-page">
    <script src="js/auth.js"></script>
    <script src="js/scoring.js"></script>

    <div class="main-container">
        <!-- Header -->
        <header class="header-actions">
            <div>
                <a href="index.html" class="btn-back">← Volver al Inicio</a>
                <h1 class="page-title">Resultados de la Temporada</h1>
            </div>
        </header>

        <!-- Matrix Container -->
        <div id="loading" style="text-align:center; padding:2rem;">Cargando resultados...</div>

        <div class="results-wrapper hidden" id="results-wrapper">
            <table class="results-table" id="matrix-table">
                <!-- Generated by JS -->
            </table>
        </div>

        <div style="margin-top:1rem; text-align:right; color:#666; font-size:0.9rem;">
            * Los datos se actualizan automáticamente según los resultados registrados en Jornadas.
        </div>

    </div>

    <script src="js/data_loader.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/resultados.js"></script>
</body>

</html>